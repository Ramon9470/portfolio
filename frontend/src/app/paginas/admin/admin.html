<div class="admin-page-container min-vh-100 p-4 p-md-5">
  <div class="admin-max-width mx-auto">

    <div class="d-flex flex-column flex-lg-row justify-content-between align-items-start align-items-lg-center gap-4 mb-5 pb-4">
      
      <div class="d-flex flex-column gap-3">
        <div>
          <h1 class="admin-title mb-1">Painel Administrativo</h1>
          <p class="admin-subtitle mb-0">Bem-vindo, {{ personalInfo.nome_completo || 'Ramon' }}!</p>
        </div>
        
        <div>
          <button (click)="logout()" class="btn-admin-logout btn-sm px-3">
            <i class="fa-solid fa-right-from-bracket me-2"></i> Sair
          </button>
        </div>
      </div>

      <div class="admin-content-box p-4 rounded-xl shadow-lg w-100" style="max-width: 450px;">
        <div class="d-flex align-items-center gap-3 mb-3">
          
          <div class="position-relative">
            <img *ngIf="personalInfo.perfil_foto_url" 
                 [src]="'http://localhost:8081' + personalInfo.perfil_foto_url" 
                 class="rounded-circle object-fit-cover border border-2 border-indigo"
                 style="width: 60px; height: 60px;">
            
            <div *ngIf="!personalInfo.perfil_foto_url" 
                 class="rounded-circle bg-dark d-flex align-items-center justify-content-center border border-2 border-indigo" 
                 style="width: 60px; height: 60px;">
               <i class="fa-solid fa-user text-white fs-4"></i>
            </div>
          </div>

          <div class="flex-grow-1">
            <h2 class="h6 fw-bold text-white mb-0">{{ personalInfo.nome_completo || 'Carregando...' }}</h2>
            <p class="text-secondary x-small mb-0">{{ personalInfo.titulo }}</p>
          </div>

          <button (click)="openProfileModal()" class="btn btn-sm btn-indigo-custom-admin ms-2">
            <i class="fa-solid fa-pen"></i>
          </button>
        </div>
        
        <div class="p-3 rounded bg-dark border border-secondary border-opacity-10">
          <p class="text-gray-300 small mb-0 fst-italic line-clamp-2">
            "{{ personalInfo.resumo || 'Sem resumo definido...' }}"
          </p>
        </div>
      </div>

    </div>

    <div class="d-flex flex-column gap-5">

      <div class="admin-content-box p-4 rounded-xl shadow-lg">
        <div class="d-flex justify-content-between align-items-center mb-4">
          <h2 class="section-heading"><i class="fa-solid fa-laptop-code text-indigo-500"></i> Meus Projetos</h2>
          <button (click)="openNewProjectModal()" class="btn-indigo-custom-admin"><i class="fa-solid fa-plus me-1"></i> Novo Projeto</button>
        </div>
        <div class="table-responsive">
          <table class="admin-table w-100">
            <thead>
              <tr class="table-header-row">
                <th class="py-3">Nome</th>
                <th class="py-3">Tecnologias</th>
                <th class="py-3 text-end">Ações</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let project of projects" class="table-body-row">
                <td class="py-3 fw-bold">{{ project.titulo }}</td>
                <td class="py-3 table-text-muted">{{ project.tecnologias }}</td>
                <td class="py-3 text-end">
                  <button (click)="openEditProjectModal(project)" class="btn-action-edit"><i class="fa-solid fa-pen"></i></button>
                  <button (click)="deleteProject(project.id)" class="btn-action-delete"><i class="fa-solid fa-trash"></i></button>
                </td>
              </tr>
            </tbody>
          </table>
          <div *ngIf="projects.length === 0" class="text-center py-5 text-secondary">Nenhum projeto cadastrado.</div>
        </div>
      </div>

      <div class="admin-content-box p-4 rounded-xl shadow-lg">
        <div class="d-flex justify-content-between align-items-center mb-4">
          <h2 class="section-heading"><i class="fa-solid fa-briefcase text-green-500"></i> Experiências</h2>
          <button (click)="openNewExperienceModal()" class="btn-green-custom-admin"><i class="fa-solid fa-plus me-1"></i> Nova Experiência</button>
        </div>
        <div class="table-responsive">
          <table class="admin-table w-100">
            <thead>
              <tr class="table-header-row">
                <th class="py-3">Empresa</th>
                <th class="py-3">Cargo</th>
                <th class="py-3">Período</th>
                <th class="py-3 text-end">Ações</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let exp of experiences" class="table-body-row">
                <td class="py-3 fw-bold">{{ exp.empresa }}</td>
                <td class="py-3 table-text-secondary">{{ exp.cargo }}</td>
                <td class="py-3 table-text-muted small">{{ exp.periodo }}</td>
                <td class="py-3 text-end">
                  <button (click)="openEditExperienceModal(exp)" class="btn-action-edit"><i class="fa-solid fa-pen"></i></button>
                  <button (click)="deleteExperience(exp.id)" class="btn-action-delete"><i class="fa-solid fa-trash"></i></button>
                </td>
              </tr>
            </tbody>
          </table>
          <div *ngIf="experiences.length === 0" class="text-center py-5 text-secondary">Nenhuma experiência cadastrada.</div>
        </div>
      </div>

      <div class="admin-content-box p-4 rounded-xl shadow-lg">
        <div class="d-flex justify-content-between align-items-center mb-4">
          <h2 class="section-heading"><i class="fa-solid fa-graduation-cap text-warning"></i> Cursos e Formação</h2>
          <button (click)="openNewCourseModal()" class="btn-indigo-custom-admin" style="background-color: #f59e0b;">
            <i class="fa-solid fa-plus me-1"></i> Novo Curso
          </button>
        </div>
        <div class="table-responsive">
          <table class="admin-table w-100">
            <thead>
              <tr class="table-header-row">
                <th class="py-3">Curso/Título</th>
                <th class="py-3">Instituição</th>
                <th class="py-3">Status</th>
                <th class="py-3 text-end">Ações</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let course of courses" class="table-body-row">
                <td class="py-3 fw-bold">{{ course.titulo }}</td>
                <td class="py-3 table-text-secondary">{{ course.instituicao }}</td>
                <td class="py-3 table-text-muted small">{{ course.status }}</td>
                <td class="py-3 text-end">
                  <button (click)="openEditCourseModal(course)" class="btn-action-edit"><i class="fa-solid fa-pen"></i></button>
                  <button (click)="deleteCourse(course.id)" class="btn-action-delete"><i class="fa-solid fa-trash"></i></button>
                </td>
              </tr>
            </tbody>
          </table>
          <div *ngIf="courses.length === 0" class="text-center py-5 text-secondary">Nenhum curso cadastrado.</div>
        </div>
      </div>
    </div>
  </div>

  <div *ngIf="showProjectModal || showExperienceModal || showCourseModal || showProfileModal" class="admin-modal-overlay">
    
    <div *ngIf="showProjectModal" class="admin-modal-card p-0">
      <div class="modal-card-header d-flex justify-content-between align-items-center p-4">
        <h3 class="h5 fw-bold mb-0">{{ isEditing ? 'Editar Projeto' : 'Novo Projeto' }}</h3>
        <button (click)="closeModals()" class="btn-modal-close"><i class="fa-solid fa-xmark"></i></button>
      </div>
      <div class="p-4 d-flex flex-column gap-3">
        <div class="admin-field"><label>TÍTULO</label><input [(ngModel)]="currentProject.titulo" type="text" class="admin-input-custom"></div>
        <div class="admin-field"><label>DESCRIÇÃO</label><textarea [(ngModel)]="currentProject.descricao" rows="3" class="admin-input-custom"></textarea></div>
        <div class="admin-field"><label>TECNOLOGIAS (SEPARADAS POR VÍRGULA)</label><input [(ngModel)]="currentProject.tecnologias" type="text" class="admin-input-custom" placeholder="Ex: PHP, Angular, SQL"></div>
        <div class="row g-3">
          <div class="col-md-6 admin-field"><label>GITHUB URL</label><input [(ngModel)]="currentProject.repo_url" type="text" class="admin-input-custom"></div>
          <div class="col-md-6 admin-field"><label>PROJETO ONLINE URL</label><input [(ngModel)]="currentProject.live_url" type="text" class="admin-input-custom"></div>
        </div>
        
        <div class="admin-field">
          <label>IMAGEM DO PROJETO (CAPA)</label>
          <input type="file" (change)="onProjectFileSelected($event)" class="admin-input-custom" accept="image/*">
          <small class="text-muted" *ngIf="currentProject.imagem_url">Imagem atual salva.</small>
        </div>
      </div>
      <div class="modal-card-footer p-4 d-flex justify-content-end gap-3">
        <button (click)="closeModals()" class="btn-admin-cancel">Cancelar</button>
        <button (click)="saveProject()" class="btn-indigo-custom-admin px-4 py-2">Salvar Projeto</button>
      </div>
    </div>

    <div *ngIf="showExperienceModal" class="admin-modal-card p-0">
      <div class="modal-card-header d-flex justify-content-between align-items-center p-4">
        <h3 class="h5 fw-bold mb-0">{{ isEditing ? 'Editar Experiência' : 'Nova Experiência' }}</h3>
        <button (click)="closeModals()" class="btn-modal-close"><i class="fa-solid fa-xmark"></i></button>
      </div>
      <div class="p-4 d-flex flex-column gap-3">
        <div class="row g-3">
          <div class="col-md-6 admin-field"><label>EMPRESA</label><input [(ngModel)]="currentExperience.empresa" type="text" class="admin-input-custom"></div>
          <div class="col-md-6 admin-field"><label>CARGO</label><input [(ngModel)]="currentExperience.cargo" type="text" class="admin-input-custom"></div>
        </div>
        <div class="admin-field"><label>PERÍODO</label><input [(ngModel)]="currentExperience.periodo" type="text" class="admin-input-custom"></div>
        <div class="admin-field"><label>DESCRIÇÃO</label><textarea [(ngModel)]="currentExperience.descricao" rows="4" class="admin-input-custom"></textarea></div>
      </div>
      <div class="modal-card-footer p-4 d-flex justify-content-end gap-3">
        <button (click)="closeModals()" class="btn-admin-cancel">Cancelar</button>
        <button (click)="saveExperience()" class="btn-green-custom-admin px-4 py-2">Salvar Experiência</button>
      </div>
    </div>

    <div *ngIf="showCourseModal" class="admin-modal-card p-0">
      <div class="modal-card-header d-flex justify-content-between p-4">
        <h3 class="h5 fw-bold mb-0">{{ isEditing ? 'Editar Curso' : 'Novo Curso' }}</h3>
        <button (click)="closeModals()" class="btn-modal-close"><i class="fa-solid fa-xmark"></i></button>
      </div>
      <div class="p-4 d-flex flex-column gap-3">
        <div class="admin-field"><label>CURSO / TÍTULO</label><input [(ngModel)]="currentCourse.titulo" class="admin-input-custom" placeholder="Ex: Análise de Sistemas"></div>
        <div class="admin-field"><label>INSTITUIÇÃO</label><input [(ngModel)]="currentCourse.instituicao" class="admin-input-custom" placeholder="Ex: USP, Udemy..."></div>
        <div class="row g-3">
          <div class="col-md-6 admin-field"><label>TIPO</label>
            <select [(ngModel)]="currentCourse.tipo" class="admin-input-custom">
              <option value="Graduação">Graduação</option><option value="Pós-graduação">Pós-graduação</option>
              <option value="Mestrado">Mestrado</option><option value="Doutorado">Doutorado</option>
              <option value="PHD">PHD</option><option value="Curso Livre">Curso Livre</option>
            </select>
          </div>
          <div class="col-md-6 admin-field"><label>STATUS</label>
            <select [(ngModel)]="currentCourse.status" class="admin-input-custom">
              <option value="Concluído">Concluído</option><option value="Em Andamento">Em Andamento</option><option value="Trancado">Trancado</option>
            </select>
          </div>
        </div>
        <div class="row g-3">
          <div class="col-md-6 admin-field"><label>DATA INÍCIO</label><input [(ngModel)]="currentCourse.data_inicio" type="date" class="admin-input-custom"></div>
          <div class="col-md-6 admin-field"><label>DATA CONCLUSÃO</label><input [(ngModel)]="currentCourse.data_conclusao" type="date" class="admin-input-custom"></div>
        </div>
        <div class="admin-field"><label>IMAGEM (LOGO)</label><input type="file" (change)="onFileSelected($event, 'imagem')" class="admin-input-custom" accept="image/*"></div>
        <div class="admin-field"><label>ARQUIVO DO CERTIFICADO</label><input type="file" (change)="onFileSelected($event, 'certificado')" class="admin-input-custom" accept=".pdf,image/*"></div>
      </div>
      <div class="modal-card-footer p-4 d-flex justify-content-end gap-3">
        <button (click)="closeModals()" class="btn-admin-cancel">Cancelar</button>
        <button (click)="saveCourse()" class="btn-indigo-custom-admin px-4 py-2" style="background-color: #f59e0b;">Salvar Curso</button>
      </div>
    </div>

    <div *ngIf="showProfileModal" class="admin-modal-card p-0">
      <div class="modal-card-header d-flex justify-content-between align-items-center p-4">
        <h3 class="h5 fw-bold mb-0">Editar Dados Pessoais</h3>
        <button (click)="closeModals()" class="btn-modal-close"><i class="fa-solid fa-xmark"></i></button>
      </div>
      
      <div class="p-4 d-flex flex-column gap-3" style="max-height: 70vh; overflow-y: auto;">
        
        <div class="admin-field p-3 rounded bg-dark border border-secondary border-opacity-25 mb-2">
          <label class="mb-2 d-block text-indigo-400 fw-bold">FOTO DE PERFIL</label>
          <div class="d-flex align-items-center gap-3">
            <img *ngIf="personalInfo.perfil_foto_url" 
                 [src]="'http://localhost:8081' + personalInfo.perfil_foto_url" 
                 class="rounded-circle" style="width: 50px; height: 50px; object-fit: cover;">
            <input type="file" (change)="onProfilePhotoSelected($event)" class="admin-input-custom" accept="image/*">
          </div>
        </div>

        <div class="row g-3">
          <div class="col-md-6 admin-field">
            <label>NOME COMPLETO</label>
            <input [(ngModel)]="personalInfo.nome_completo" type="text" class="admin-input-custom">
          </div>
          <div class="col-md-6 admin-field">
            <label>TÍTULO (CARGO)</label>
            <input [(ngModel)]="personalInfo.titulo" type="text" class="admin-input-custom">
          </div>
        </div>

        <div class="admin-field">
          <label>RESUMO PROFISSIONAL</label>
          <textarea [(ngModel)]="personalInfo.resumo" rows="4" class="admin-input-custom" placeholder="Escreva seu resumo aqui..."></textarea>
        </div>

        <div class="row g-3">
          <div class="col-md-6 admin-field"><label>EMAIL</label><input [(ngModel)]="personalInfo.email" type="text" class="admin-input-custom"></div>
          <div class="col-md-6 admin-field"><label>TELEFONE</label><input [(ngModel)]="personalInfo.telefone" type="text" class="admin-input-custom"></div>
        </div>

        <div class="row g-3">
          <div class="col-md-6 admin-field"><label>CIDADE</label><input [(ngModel)]="personalInfo.cidade" type="text" class="admin-input-custom"></div>
          <div class="col-md-6 admin-field"><label>ESTADO</label><input [(ngModel)]="personalInfo.estado" type="text" class="admin-input-custom"></div>
        </div>

        <div class="admin-field"><label>LINKEDIN URL</label><input [(ngModel)]="personalInfo.linkedin_url" type="text" class="admin-input-custom"></div>
        <div class="admin-field"><label>GITHUB URL</label><input [(ngModel)]="personalInfo.github_url" type="text" class="admin-input-custom"></div>

      </div>

      <div class="modal-card-footer p-4 d-flex justify-content-end gap-3">
        <button (click)="closeModals()" class="btn-admin-cancel">Cancelar</button>
        <button (click)="saveProfile()" class="btn-indigo-custom-admin px-4 py-2">Salvar Alterações</button>
      </div>
    </div>

  </div>
</div>